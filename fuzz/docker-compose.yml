services:
  fuzz-x86_64:
    build:
      context: ..
      dockerfile: fuzz/Dockerfile
    command: cargo fuzz run x86_64_decoder -- -max_total_time=3600
    volumes:
      - ./corpus/x86_64_decoder:/hexray/fuzz/corpus/x86_64_decoder
      - ./artifacts:/hexray/fuzz/artifacts
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 2G

  fuzz-arm64:
    build:
      context: ..
      dockerfile: fuzz/Dockerfile
    command: cargo fuzz run arm64_decoder -- -max_total_time=3600
    volumes:
      - ./corpus/arm64_decoder:/hexray/fuzz/corpus/arm64_decoder
      - ./artifacts:/hexray/fuzz/artifacts
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 2G

  fuzz-riscv:
    build:
      context: ..
      dockerfile: fuzz/Dockerfile
    command: cargo fuzz run riscv_decoder -- -max_total_time=3600
    volumes:
      - ./corpus/riscv_decoder:/hexray/fuzz/corpus/riscv_decoder
      - ./artifacts:/hexray/fuzz/artifacts
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 2G

  fuzz-elf:
    build:
      context: ..
      dockerfile: fuzz/Dockerfile
    command: cargo fuzz run elf_parser -- -max_total_time=3600
    volumes:
      - ./corpus/elf_parser:/hexray/fuzz/corpus/elf_parser
      - ./artifacts:/hexray/fuzz/artifacts
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 2G

  fuzz-macho:
    build:
      context: ..
      dockerfile: fuzz/Dockerfile
    command: cargo fuzz run macho_parser -- -max_total_time=3600
    volumes:
      - ./corpus/macho_parser:/hexray/fuzz/corpus/macho_parser
      - ./artifacts:/hexray/fuzz/artifacts
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 2G

  # Targeted structure-aware fuzzers for overnight runs
  fuzz-elf-structured:
    build:
      context: ..
      dockerfile: fuzz/Dockerfile
    command: cargo fuzz run elf_structured -- -max_total_time=36000 -dict=/hexray/fuzz/dictionaries/elf.dict
    volumes:
      - ./corpus/elf_structured:/hexray/fuzz/corpus/elf_structured
      - ./artifacts:/hexray/fuzz/artifacts
      - ./dictionaries:/hexray/fuzz/dictionaries:ro
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 4G

  fuzz-macho-structured:
    build:
      context: ..
      dockerfile: fuzz/Dockerfile
    command: cargo fuzz run macho_structured -- -max_total_time=36000 -dict=/hexray/fuzz/dictionaries/macho.dict
    volumes:
      - ./corpus/macho_structured:/hexray/fuzz/corpus/macho_structured
      - ./artifacts:/hexray/fuzz/artifacts
      - ./dictionaries:/hexray/fuzz/dictionaries:ro
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 4G
